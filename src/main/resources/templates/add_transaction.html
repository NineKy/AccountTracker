<!DOCTYPE html>
<html lang="en">
<head>
    <title>Login V1</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--===============================================================================================-->
    <!--    <link rel="icon" type="image/png" href="/images/icons/favicon.ico"/>-->
    <!--===============================================================================================-->
    <!--    <link rel="stylesheet" type="text/css" href="/vendor/bootstrap/css/bootstrap.min.css">-->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <!--===============================================================================================-->
    <!--    <link rel="stylesheet" type="text/css" href="/fonts/font-awesome-4.7.0/css/font-awesome.min.css">-->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!--===============================================================================================-->
    <!--    <link rel="stylesheet" type="text/css" href="/vendor/animate/animate.css">-->
    <!--===============================================================================================-->
    <!--    <link rel="stylesheet" type="text/css" href="/vendor/css-hamburgers/hamburgers.min.css">-->
    <!--===============================================================================================-->
    <!--    <link rel="stylesheet" type="text/css" href="/vendor/select2/select2.min.css">-->
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="/css/util.css">
    <link rel="stylesheet" type="text/css" href="/css/main.css">
    <!--===============================================================================================-->
</head>
<body>

<div class="limiter">
    <div class="container-login100">
        <div class="my-wrap-login100">
            <form class="login100-form validate-form" onsubmit="recordTran(); return false;">
                <span class="login100-form-title_sub" id = "loginId"></span>
                <span class="login100-form-title">어디에 돈을 쓰셨나요??</span>

                <div class="wrap-input100 validate-input">
                    <input class="input100" type="text" id="tag" name="tag" placeholder="Select Tag from RIGHT">
                    <input class="input100" type="text" id="tagId" name="tagId" style="display: none">
                    <span class="focus-input100"></span>
                    <span class="symbol-input100">
                        <i class="fa fa-user" aria-hidden="true"></i>
                    </span>
                </div>
                <div class="wrap-input100 validate-input">
                    <input class="input100" type="text" id="amount" name="amount" placeholder="Amount">
                    <span class="focus-input100"></span>
                    <span class="symbol-input100">
                        <i class="fa fa-user" aria-hidden="true"></i>
                    </span>
                </div>
                <div class="wrap-input100 validate-input">
                    <input class="input100" type="text" id="usage" name="usage" placeholder="Usage">
                    <span class="focus-input100"></span>
                    <span class="symbol-input100">
                        <i class="fa fa-user" aria-hidden="true"></i>
                    </span>
                </div>
                <div class="wrap-input100 validate-input">
                    <input class="input100" type="text" id="desc" name="desc" placeholder="Desc">
                    <span class="focus-input100"></span>
                    <span class="symbol-input100">
                        <i class="fa fa-user" aria-hidden="true"></i>
                    </span>
                </div>
                <div class="wrap-input100 validate-input">
                    <input class="input100" type="text" id="yyyymmdd" name="yyyymmdd" placeholder="$getCurrentYyyymmdd()">
                    <span class="focus-input100"></span>
                    <span class="symbol-input100">
                        <i class="fa fa-user" aria-hidden="true"></i>
                    </span>
                </div>
                <div class="wrap-input100 validate-input">
                    <!--                    <input class="input100" type="text" id="moneyType" name="moneyType" placeholder="Source From" style="display: none">-->
                    <span class="focus-input100"></span>
                    <span class="symbol-input100">
                        <i class="fa fa-tag" aria-hidden="true"></i>
                    </span>
                    <span class="input100" style="align-items: center">
                        <label>
                            <input type="radio" name="moneyType" value="FREE">
                            FREE
                        </label>
                        <label>
                            <input type="radio" name="moneyType" value="MINE">
                            MINE
                        </label>
                    </span>
                </div>

                <div class="container-login100-form-btn">
                    <button class="login100-form-btn">
                        저장하기
                    </button>
                </div>
            </form>

            <div class="login100-pic js-tilt" data-tilt>
                <div>Tag 선택</div>
                <pre id="resp"></pre>
            </div>

            <!--            return false은 이벤트의 기본 동작을 중지-->
            <div class="text-center p-t-136">
                <a class="txt2" onclick="todayTran()">
                    오늘의 소비를 확인하기
                    <i class="fa fa-long-arrow-right m-l-5" aria-hidden="true"></i>
                </a>
                <div></div>
                <div></div>
                <a class="txt2" onclick="resetInput()">
                    기록중인거 초기화!!
                    <i class="fa fa-long-arrow-right m-l-5" aria-hidden="true"></i>
                </a>
                <a class="txt2" onclick="allTran()">
                    현재까지의 모든 기록들 확인
                    <i class="fa fa-long-arrow-right m-l-5" aria-hidden="true"></i>
                </a>
            </div>

        </div>
    </div>
</div>

<!--===============================================================================================-->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    document.getElementById('yyyymmdd').placeholder = "yyyymmdd ex)"+getCurrentYyyymmdd();
    window.onload = function () {
        $.ajax({
            url: "/tag/list",
            type: "GET",
            dataType: "json",

            success: function (data) {
                console.log(data);

                data.forEach(function (item) {
                    var roundDiv = document.createElement('div');

                    var iName = document.createElement("i");
                    iName.className = "fa-regular fa-pot-food";

                    var button = document.createElement('button');
                    button.className = 'btn btn-primary';
                    button.addEventListener('click', function () {
                        $("#tag").val(item.name);
                        $("#tagId").val(item.id);
                    });

                    // madeStr += "TAG(" + item.id + ") : " + item.name + ", 노출색 : " + item.color + "\n";
                    var str = item.name + " | 노출색 : " + item.color + "\n";

                    button.textContent = str;
                    button.style.paddingBottom = "10px";
                    button.appendChild(iName);
                    roundDiv.appendChild(button);

                    $("#resp").append(roundDiv);
                })


                // $("#resp").text(madeStr);

            },
            error: function (data) {
                alert("no tags");
            }
        })

        var username = getCookie("userId");
        if(username == null) {
            alert("로그인이 필요합니다");
            location.href = "/view/login";
        }
        document.getElementById("loginId").innerHTML = username + "님 환영합니다";
    }

    function getCookie(name) {
        var nameEQ = name + "=";
        var ca = document.cookie.split(';');
        for (var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) === ' ') c = c.substring(1, c.length);
            if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
        }
        return null;
    }

    function getSelectedRadioValue(name) {
        var radios = document.getElementsByName(name);
        for (var i = 0; i < radios.length; i++) {
            if (radios[i].checked) {
                return radios[i].value;
            }
        }
    }

    function recordTran() {
        $.ajax({
            url: "/transaction",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify({
                "tagId": $("#tagId").val(),
                "amount": $("#amount").val(),
                "title": $("#usage").val(),
                "content": $("#desc").val(),
                "moneyType": getSelectedRadioValue("moneyType"),
                "registeredAtYyyymmdd": $("#yyyymmdd").val(),
                "userId": getCookie("userId")
            }),
            success: function (data) {
                alert("기록 완료! 오늘도 잊지 않고 살아요!");
                resetInput();

            },
            error: function (data) {
                alert("ERROR! CHECK LOG");
                console.log(data)
            }
        })
    }

    function todayTran() {
        window.location.href = '/view/tran/today'
    }

    function allTran() {
        window.location.href = '/view/tran/all'
    }

    function resetInput() {
        document.getElementById("tag").value = "";
        document.getElementById("amount").value = "";
        document.getElementById("usage").value = "";
        document.getElementById("desc").value = "";
        document.getElementById("moneyType").value = "";
        document.getElementById("yyyymmdd").value = "";
    }

    function getCurrentYyyymmdd() {
        // 현재 날짜 객체 생성
        const currentDate = new Date();

        // 연도, 월, 일 가져오기
        const year = currentDate.getFullYear();
        const month = String(currentDate.getMonth() + 1).padStart(2, '0');
        const day = String(currentDate.getDate()).padStart(2, '0');

        // yyyyMMdd 형태로 출력
        const formattedDate = `${year}${month}${day}`;

        return formattedDate;
    }
</script>

</body>
</html>